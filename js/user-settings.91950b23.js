(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["user-settings"],{1276:function(e,t,n){"use strict";var a=n("d784"),s=n("44e7"),r=n("825a"),i=n("1d80"),o=n("4840"),l=n("8aa5"),u=n("50c4"),c=n("14c3"),p=n("9263"),d=n("d039"),f=[].push,h=Math.min,m=4294967295,v=!d((function(){return!RegExp(m,"y")}));a("split",2,(function(e,t,n){var a;return a="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,n){var a=String(i(this)),r=void 0===n?m:n>>>0;if(0===r)return[];if(void 0===e)return[a];if(!s(e))return t.call(a,e,r);var o,l,u,c=[],d=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),h=0,v=new RegExp(e.source,d+"g");while(o=p.call(v,a)){if(l=v.lastIndex,l>h&&(c.push(a.slice(h,o.index)),o.length>1&&o.index<a.length&&f.apply(c,o.slice(1)),u=o[0].length,h=l,c.length>=r))break;v.lastIndex===o.index&&v.lastIndex++}return h===a.length?!u&&v.test("")||c.push(""):c.push(a.slice(h)),c.length>r?c.slice(0,r):c}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:t.call(this,e,n)}:t,[function(t,n){var s=i(this),r=void 0==t?void 0:t[e];return void 0!==r?r.call(t,s,n):a.call(String(s),t,n)},function(e,s){var i=n(a,e,this,s,a!==t);if(i.done)return i.value;var p=r(e),d=String(this),f=o(p,RegExp),g=p.unicode,b=(p.ignoreCase?"i":"")+(p.multiline?"m":"")+(p.unicode?"u":"")+(v?"y":"g"),w=new f(v?p:"^(?:"+p.source+")",b),x=void 0===s?m:s>>>0;if(0===x)return[];if(0===d.length)return null===c(w,d)?[d]:[];var y=0,P=0,_=[];while(P<d.length){w.lastIndex=v?P:0;var C,S=c(w,v?d:d.slice(P));if(null===S||(C=h(u(w.lastIndex+(v?0:P)),d.length))===y)P=l(d,P,g);else{if(_.push(d.slice(y,P)),_.length===x)return _;for(var $=1;$<=S.length-1;$++)if(_.push(S[$]),_.length===x)return _;P=y=C}}return _.push(d.slice(y)),_}]}),!v)},"14c3":function(e,t,n){var a=n("c6b6"),s=n("9263");e.exports=function(e,t){var n=e.exec;if("function"===typeof n){var r=n.call(e,t);if("object"!==typeof r)throw TypeError("RegExp exec method returned something other than an Object or null");return r}if("RegExp"!==a(e))throw TypeError("RegExp#exec called on incompatible receiver");return s.call(e,t)}},"3a73":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"user-settings"},[n("b-container",[n("b-row",[n("b-col",{staticClass:"mx-auto",attrs:{cols:"12",lg:"8"}},[n("div",{staticClass:"user-settings__title"},[e._v("個人資料")]),n("b-form",{staticClass:"user-settings-photo",on:{submit:function(t){return t.preventDefault(),e.photoOnSubmit(t)},reset:function(t){return t.preventDefault(),e.photoOnCancel(t)}}},[n("div",{staticClass:"input-header"},[n("label",{staticClass:"label-text"},[e._v("你的照片")]),e.isPhotChange?n("div",{staticClass:"user-settings__button-group"},[n("b-button",{staticClass:"custom-btn mr-2",attrs:{type:"submit",variant:"outline-warning",size:"sm"}},[e._v("保存")]),n("b-button",{staticClass:"custom-btn",attrs:{type:"reset",variant:"outline-secondary",size:"sm"}},[e._v("取消")])],1):e._e()]),n("img-inputer",{ref:"img-inputer",staticClass:"mx-auto",attrs:{"img-src":this.$store.state.user.photoUrl,"max-size":1024,icon:"img",placeholder:"請選擇照片","bottom-text":"變更你的照片","no-multiple-text":"",exceedSizeText:"檔案大小不能超過1MB",accept:"image/*"},on:{onChange:e.photOnChange},model:{value:e.userPhoto,callback:function(t){e.userPhoto=t},expression:"userPhoto"}})],1),e._l(e.settingInputDatas,(function(e){return n("SettingInput",{attrs:{data:e.data,fieldname:e.fieldname,inputname:e.inputname,type:e.type,rules:e.rules,placeholder:e.placeholder,editable:e.editable}})}))],2)],1)],1)],1)},s=[],r=(n("ac1f"),n("1276"),n("96cf"),n("1da1")),i=n("7bb1"),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"user-settings-input"},[n("div",{staticClass:"input-header"},[n("label",{staticClass:"label-text"},[e._v(e._s(e.fieldname))]),e.isDisabled&&e.editable?n("font-awesome-icon",{staticClass:"icon",attrs:{icon:["fas","pencil-alt"],size:"lg","fixed-width":""},on:{click:e.edit}}):e._e(),!e.isDisabled&&e.editable?n("div",{staticClass:"button-group"},[n("b-button",{staticClass:"custom-btn mr-2",attrs:{variant:"outline-warning",size:"sm"},on:{click:function(t){"password"!==e.type?e.onSubmit():e.passwordOnSubmit()}}},[e._v("保存")]),n("b-button",{staticClass:"custom-btn",attrs:{variant:"outline-secondary",size:"sm"},on:{click:e.onCancel}},[e._v("取消")])],1):e._e()],1),n("div",{staticClass:"input-content"},[n("ValidationProvider",{ref:e.inputname+"-valid",attrs:{rules:e.rules,name:e.inputname,tag:"div"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.errors,s=t.valid,r=t.dirty;return[n("b-form-input",{ref:e.inputname,attrs:{name:e.inputname,type:e.type,placeholder:e.placeholder,state:e.validState(a,s,r),disabled:e.isDisabled},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}}),n("p",{staticClass:"validate-message"},[e._v(e._s(a[0]))])]}}])}),"password"!==e.type||e.isDisabled?e._e():n("ValidationProvider",{ref:"new-password-valid",attrs:{rules:e.rules,name:"new-password",tag:"div"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.errors,s=t.valid,r=t.dirty;return[n("b-form-input",{ref:"new-password",attrs:{type:e.type,state:e.validState(a,s,r),disabled:e.isDisabled,name:"new-password",placeholder:"請輸入新的密碼"},model:{value:e.newPassword,callback:function(t){e.newPassword=t},expression:"newPassword"}}),n("p",{staticClass:"validate-message"},[e._v(e._s(a[0]))])]}}],null,!1,1161844043)}),"password"===e.type&&e.newPassword?n("ValidationProvider",{ref:"confirm-new-password-valid",attrs:{rules:"required|confirmed:new-password",name:"confirm-new-password",tag:"div"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.errors,s=t.valid,r=t.dirty;return[n("b-form-input",{ref:"confirm-new-password",attrs:{type:e.type,state:e.validState(a,s,r),disabled:e.isDisabled,name:"confirm-new-password",placeholder:"確認新的密碼"},model:{value:e.confirmNewPassword,callback:function(t){e.confirmNewPassword=t},expression:"confirmNewPassword"}}),n("p",{staticClass:"validate-message"},[e._v(e._s(a[0]))])]}}],null,!1,672800152)}):e._e()],1)])},l=[],u=n("ade3"),c={name:"SettingInput",components:{ValidationProvider:i["b"]},props:{data:String,fieldname:String,inputname:String,type:{type:String,default:"text"},rules:String,placeholder:String,editable:{type:Boolean,default:!0}},data:function(){return{isDisabled:!0,value:this.data,newPassword:"",confirmNewPassword:""}},computed:{user:function(){return this.$store.state.user}},methods:{edit:function(){var e=this;this.editable&&(this.isDisabled=!1,this.$nextTick((function(){return e.$refs[e.inputname].focus()})),"password"===this.type&&(this.value=""))},onCancel:function(){console.log(this.$refs),"password"===this.type&&(this.newPassword="",this.confirmNewPassword=""),this.value=this.data,this.$refs[this.inputname+"-valid"].reset(),this.isDisabled=!0},onSubmit:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var n,a,s,r,i,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!1!==t.$refs[t.inputname].state){e.next=2;break}return e.abrupt("return");case 2:return n=Object(u["a"])({},t.inputname,t.value),e.prev=3,e.next=6,t.axios.patch("https://cuishare.herokuapp.com/users/"+t.user.id,n);case 6:if(a=e.sent,s=a.data,r=s.success,i=s.result,r){e.next=10;break}return e.abrupt("return");case 10:o=Object(u["a"])({},t.inputname,i[t.inputname]),t.$store.commit("updateUser",o),t.$refs[t.inputname+"-valid"].reset(),t.isDisabled=!0,e.next=22;break;case 16:e.prev=16,e.t0=e["catch"](3),t.value=t.data,t.$refs[t.inputname+"-valid"].reset(),alert(e.t0.response.data.message),console.log(e.t0);case 22:case"end":return e.stop()}}),e,null,[[3,16]])})))()},passwordOnSubmit:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.$refs[e.inputname].state&&e.$refs["new-password"].state&&e.$refs["confirm-new-password"].state){t.next=2;break}return t.abrupt("return");case 2:return n={password:e.value,newPassword:e.newPassword},t.prev=3,t.next=6,e.axios.patch("https://cuishare.herokuapp.com/users/"+e.user.id,n);case 6:a=t.sent,a.data.success&&(e.$refs[e.inputname+"-valid"].reset(),e.value=e.newPassword,e.newPassword="",e.confirmNewPassword="",e.isDisabled=!0,e.$toasted.success("密碼變更成功")),t.next=20;break;case 10:t.prev=10,t.t0=t["catch"](3),e.$refs[e.inputname+"-valid"].reset(),e.$refs["new-password-valid"].reset(),e.$refs["confirm-new-password-valid"].reset(),e.value="",e.newPassword="",e.confirmNewPassword="",e.$toasted.error("密碼錯誤"),console.log(t.t0);case 20:case"end":return t.stop()}}),t,null,[[3,10]])})))()},validState:function(e,t,n){return!(e[0]&&!t)&&(!(e[0]||!n||!t)||null)}}},p=c,d=n("2877"),f=Object(d["a"])(p,o,l,!1,null,null,null),h=f.exports,m={name:"UserSettings",components:{ValidationProvider:i["b"],ValidationObserver:i["a"],SettingInput:h},data:function(){return{userPhoto:null,isPhotChange:!1,settingInputDatas:[{data:this.$store.state.user.email,fieldname:"你的帳號",inputname:"email",type:"text",editable:!1},{data:"123456789",fieldname:"密碼",inputname:"password",type:"password",rules:"required|alphaNum|min:6|max:30",placeholder:"請輸入原本的密碼"},{data:this.$store.state.user.username,fieldname:"你的暱稱",inputname:"username",type:"text",rules:"required|min:4|max:30|bannedName",placeholder:"請輸入暱稱"},{data:this.$store.state.user.about,fieldname:"關於你",inputname:"about",type:"text",rules:"max:255",placeholder:"請輸入關於你的介紹"}]}},computed:{user:function(){return this.$store.state.user}},methods:{photOnChange:function(){this.isPhotChange=!0},photoOnSubmit:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var n,a,s,r,i,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.user.id,a=e.user.photoUrl.split("/"),s=a[a.length-1],r=new FormData,r.append("image",e.userPhoto),t.prev=5,t.next=8,e.axios.post("https://cuishare.herokuapp.com/pictures",r);case 8:return i=t.sent,o={photoUrl:"https://cuishare.herokuapp.com/pictures/"+i.data.filename},t.next=12,e.axios.patch("https://cuishare.herokuapp.com/users/"+n,o);case 12:if(e.$store.commit("updateUser",o),!s){t.next=16;break}return t.next=16,e.axios.delete("https://cuishare.herokuapp.com/pictures/"+s);case 16:e.$refs["img-inputer"].fileName="",e.isPhotChange=!1,t.next=23;break;case 20:t.prev=20,t.t0=t["catch"](5),console.log(t.t0);case 23:case"end":return t.stop()}}),t,null,[[5,20]])})))()},photoOnCancel:function(){this.$refs["img-inputer"].dataUrl=this.$store.state.user.photoUrl,this.$refs["img-inputer"].fileName="",this.isPhotChange=!1}}},v=m,g=Object(d["a"])(v,a,s,!1,null,null,null);t["default"]=g.exports},"8aa5":function(e,t,n){"use strict";var a=n("6547").charAt;e.exports=function(e,t,n){return t+(n?a(e,t).length:1)}},9263:function(e,t,n){"use strict";var a=n("ad6d"),s=n("9f7f"),r=RegExp.prototype.exec,i=String.prototype.replace,o=r,l=function(){var e=/a/,t=/b*/g;return r.call(e,"a"),r.call(t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),u=s.UNSUPPORTED_Y||s.BROKEN_CARET,c=void 0!==/()??/.exec("")[1],p=l||c||u;p&&(o=function(e){var t,n,s,o,p=this,d=u&&p.sticky,f=a.call(p),h=p.source,m=0,v=e;return d&&(f=f.replace("y",""),-1===f.indexOf("g")&&(f+="g"),v=String(e).slice(p.lastIndex),p.lastIndex>0&&(!p.multiline||p.multiline&&"\n"!==e[p.lastIndex-1])&&(h="(?: "+h+")",v=" "+v,m++),n=new RegExp("^(?:"+h+")",f)),c&&(n=new RegExp("^"+h+"$(?!\\s)",f)),l&&(t=p.lastIndex),s=r.call(d?n:p,v),d?s?(s.input=s.input.slice(m),s[0]=s[0].slice(m),s.index=p.lastIndex,p.lastIndex+=s[0].length):p.lastIndex=0:l&&s&&(p.lastIndex=p.global?s.index+s[0].length:t),c&&s&&s.length>1&&i.call(s[0],n,(function(){for(o=1;o<arguments.length-2;o++)void 0===arguments[o]&&(s[o]=void 0)})),s}),e.exports=o},"9f7f":function(e,t,n){"use strict";var a=n("d039");function s(e,t){return RegExp(e,t)}t.UNSUPPORTED_Y=a((function(){var e=s("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),t.BROKEN_CARET=a((function(){var e=s("^r","gy");return e.lastIndex=2,null!=e.exec("str")}))},ac1f:function(e,t,n){"use strict";var a=n("23e7"),s=n("9263");a({target:"RegExp",proto:!0,forced:/./.exec!==s},{exec:s})},d784:function(e,t,n){"use strict";n("ac1f");var a=n("6eeb"),s=n("d039"),r=n("b622"),i=n("9263"),o=n("9112"),l=r("species"),u=!s((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),c=function(){return"$0"==="a".replace(/./,"$0")}(),p=r("replace"),d=function(){return!!/./[p]&&""===/./[p]("a","$0")}(),f=!s((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]}));e.exports=function(e,t,n,p){var h=r(e),m=!s((function(){var t={};return t[h]=function(){return 7},7!=""[e](t)})),v=m&&!s((function(){var t=!1,n=/a/;return"split"===e&&(n={},n.constructor={},n.constructor[l]=function(){return n},n.flags="",n[h]=/./[h]),n.exec=function(){return t=!0,null},n[h](""),!t}));if(!m||!v||"replace"===e&&(!u||!c||d)||"split"===e&&!f){var g=/./[h],b=n(h,""[e],(function(e,t,n,a,s){return t.exec===i?m&&!s?{done:!0,value:g.call(t,n,a)}:{done:!0,value:e.call(n,t,a)}:{done:!1}}),{REPLACE_KEEPS_$0:c,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:d}),w=b[0],x=b[1];a(String.prototype,e,w),a(RegExp.prototype,h,2==t?function(e,t){return x.call(e,this,t)}:function(e){return x.call(e,this)})}p&&o(RegExp.prototype[h],"sham",!0)}}}]);
//# sourceMappingURL=user-settings.91950b23.js.map