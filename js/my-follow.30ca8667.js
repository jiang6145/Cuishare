(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["my-follow"],{"0c66":function(o,t,e){"use strict";e.r(t);var l=function(){var o=this,t=o.$createElement,e=o._self._c||t;return e("div",{staticClass:"my-follow"},[e("b-container",[e("b-row",[e("b-col",{staticClass:"mx-auto mb-4",attrs:{cols:"12",lg:"10"}},[e("h2",{staticClass:"my-follow__title"},[o._v("追蹤與粉絲")])]),e("b-col",{staticClass:"mx-auto",attrs:{cols:"12",lg:"10"}},[e("b-tabs",[e("b-tab",{attrs:{title:"追蹤中 "+o.following.length}},o._l(o.following,(function(t){return e("div",{staticClass:"follow-item"},[e("b-avatar",{staticClass:"follow-item__avatar",attrs:{src:t.photoUrl,size:"5rem",to:"/blog/"+t._id}}),e("div",{staticClass:"follow-item__info"},[e("p",{staticClass:"follow-item__username"},[o._v(o._s(t.username)),e("b-dropdown",{staticClass:"follow-item__dropdown",attrs:{variant:"link","no-caret":"",right:""},scopedSlots:o._u([{key:"button-content",fn:function(){return[e("font-awesome-icon",{staticClass:"icon follow-item__icon",attrs:{icon:["fas","chevron-down"],"fixed-width":""}})]},proxy:!0}],null,!0)},[e("b-dropdown-item",{directives:[{name:"b-modal",rawName:"v-b-modal",value:"his-follow-modal",expression:"'his-follow-modal'"}],on:{click:function(e){return o.lookHisFollowers(t)}}},[o._v("他的粉絲")]),e("b-dropdown-item",{directives:[{name:"b-modal",rawName:"v-b-modal",value:"his-follow-modal",expression:"'his-follow-modal'"}],on:{click:function(e){return o.lookHisFollowing(t)}}},[o._v("他的追蹤")]),e("b-dropdown-item",{staticClass:"dropdown--danger",on:{click:function(e){return o.unFollowing(t)}}},[o._v("取消追蹤")])],1)],1),e("p",{staticClass:"follow-item__about"},[o._v(o._s(t.about))]),e("div",{staticClass:"follow-item__his-follow"},[e("span",{staticClass:"tag no-hover"},[o._v(o._s("粉絲 "+t.followers.length))]),e("span",{staticClass:"tag no-hover"},[o._v(o._s("追蹤中 "+t.following.length))])])])],1)})),0),e("b-tab",{attrs:{title:"粉絲 "+o.followers.length}},o._l(o.followers,(function(t){return e("div",{staticClass:"follow-item"},[e("b-avatar",{staticClass:"follow-item__avatar",attrs:{src:t.photoUrl,size:"5rem",to:"/blog/"+t._id}}),e("div",{staticClass:"follow-item__info"},[e("p",{staticClass:"follow-item__username"},[o._v(o._s(t.username)),e("b-dropdown",{staticClass:"follow-item__dropdown",attrs:{variant:"link","no-caret":"",right:""},scopedSlots:o._u([{key:"button-content",fn:function(){return[e("font-awesome-icon",{staticClass:"icon follow-item__icon",attrs:{icon:["fas","chevron-down"],"fixed-width":""}})]},proxy:!0}],null,!0)},[e("b-dropdown-item",{directives:[{name:"b-modal",rawName:"v-b-modal",value:"his-follow-modal",expression:"'his-follow-modal'"}],on:{click:function(e){return o.lookHisFollowers(t)}}},[o._v("他的粉絲")]),e("b-dropdown-item",{directives:[{name:"b-modal",rawName:"v-b-modal",value:"his-follow-modal",expression:"'his-follow-modal'"}],on:{click:function(e){return o.lookHisFollowing(t)}}},[o._v("他的追蹤")])],1)],1),e("p",{staticClass:"follow-item__about"},[o._v(o._s(t.about))]),e("div",{staticClass:"follow-item__his-follow"},[e("span",{staticClass:"tag no-hover"},[o._v(o._s("粉絲 "+t.followers.length))]),e("span",{staticClass:"tag no-hover"},[o._v(o._s("追蹤中 "+t.following.length))])])])],1)})),0)],1)],1)],1)],1),e("b-modal",{attrs:{id:"his-follow-modal",title:o.hisFollow.modalTitle,"hide-footer":""}},o._l(o.hisFollow.follow,(function(t){return e("div",{staticClass:"follow-item py-3"},[e("b-avatar",{key:t._id,staticClass:"follow-item__avatar mr-3",attrs:{size:"3rem",src:t.photoUrl,to:"/blog/"+t._id}}),e("span",{staticClass:"follow-item__username"},[o._v(o._s(t.username))]),e("FollowButton",{staticClass:"ml-auto",attrs:{author:t},on:{onClick:o.onFollowing}})],1)})),0)],1)},s=[],n=(e("c740"),e("a434"),e("96cf"),e("1da1")),a=e("e292"),i={name:"MyFollowing",components:{FollowButton:a["a"]},data:function(){return{following:[],followers:[],hisFollow:{}}},methods:{unFollowing:function(o){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var l,s,n,a,i,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$bvModal.msgBoxConfirm("你確定不要繼續追蹤「".concat(o.username,"」嗎?"),{title:"取消關注",size:"md",buttonSize:"sm",okVariant:"danger",okTitle:"確定",cancelTitle:"取消",hideHeaderClose:!0,centered:!0,headerClass:"border-bottom-0 justify-content-center",bodyClass:"text-center",footerClass:"border-top-0 justify-content-center"});case 3:if(l=e.sent,l){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,t.axios.patch("https://cuishare.herokuapp.com/users/follow/"+o._id);case 8:s=e.sent,n=s.data,a=n.success,i=n.result,a&&(t.$store.commit("following",i),r=t.following.findIndex((function(t){var e=t._id;return e===o._id})),t.following.splice(r,1)),e.next=16;break;case 13:e.prev=13,e.t0=e["catch"](0),console.log(e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,13]])})))()},lookHisFollowing:function(o){this.hisFollow={modalTitle:"追蹤中 "+o.following.length,follow:o.following}},lookHisFollowers:function(o){this.hisFollow={modalTitle:"粉絲 "+o.followers.length,follow:o.followers}},onFollowing:function(o){var t=this.following.findIndex((function(t){var e=t._id;return e===o._id}));t<0?this.following.unshift(o):this.following.splice(t,1)}},mounted:function(){var o=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var e,l,s,n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=o.$loading.show(),t.prev=1,t.next=4,o.axios.get("https://cuishare.herokuapp.com/users/follow/following");case 4:l=t.sent,s=l.data,n=s.success,a=s.result,n&&(o.following=a.following,o.followers=a.followers),t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](1),console.log(t.t0);case 12:setTimeout((function(){e.hide()}),500);case 13:case"end":return t.stop()}}),t,null,[[1,9]])})))()}},r=i,c=e("2877"),u=Object(c["a"])(r,l,s,!1,null,null,null);t["default"]=u.exports},e292:function(o,t,e){"use strict";var l=function(){var o=this,t=o.$createElement,e=o._self._c||t;return e("div",[o.isMyself?o._e():e("b-button",{staticClass:"custom-btn custom-btn--follow",class:o.isFollow?"btn--following":"",attrs:{variant:"outline-warning",size:"sm"},on:{click:o.follow}},[o._v(o._s(o.isFollow?"追蹤中":"追蹤"))])],1)},s=[],n=(e("caad"),e("2532"),e("96cf"),e("1da1")),a={name:"FollowButton",props:{author:Object},computed:{user:function(){return this.$store.state.user},isFollow:function(){return this.user.following.includes(this.author._id)},isMyself:function(){return this.author._id===this.user.id}},methods:{follow:function(){var o=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var e,l,s,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!o.user.isBlocked){t.next=2;break}return t.abrupt("return",o.$toasted.error("你的帳號被封鎖，不能操作"));case 2:if(t.prev=2,o.user.id){t.next=5;break}return t.abrupt("return",o.$bvModal.show("user-modal"));case 5:return t.next=7,o.axios.patch("https://cuishare.herokuapp.com/users/follow/"+o.author._id);case 7:e=t.sent,l=e.data,s=l.success,n=l.result,s&&(o.$store.commit("following",n),o.$emit("onClick",n)),t.next=15;break;case 12:t.prev=12,t.t0=t["catch"](2),console.log(t.t0);case 15:case"end":return t.stop()}}),t,null,[[2,12]])})))()}}},i=a,r=e("2877"),c=Object(r["a"])(i,l,s,!1,null,null,null);t["a"]=c.exports}}]);
//# sourceMappingURL=my-follow.30ca8667.js.map